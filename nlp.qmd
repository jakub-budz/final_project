---
title: "text processing attempt"
format: html
---


```{python}
import spacy
import pandas as pd
import altair as alt
from spacytextblob.spacytextblob import SpacyTextBlob
nlp = spacy.load('en_core_web_sm')
nlp.add_pipe('spacytextblob')
```

```{python}
# Make function to analyze sentiment
def analyze_text(file_name):
    base_name = file_name.split('/')[-1].replace('.txt', '')
    with open(file_name, 'r', encoding='utf-8') as file:
        text = file.read()
    doc = nlp(text)
    polarity = doc._.blob.polarity
    subjectivity = doc._.blob.subjectivity
    
    sentence_polarities = []
    for i, sentence in enumerate(doc.sents):
        polarity = sentence._.blob.polarity
        sentence_polarities.append({"n": i + 1, f"{base_name}_polarity": polarity})
    df = pd.DataFrame(sentence_polarities)

    chart = alt.Chart(df).mark_line().encode(
        x=alt.X('n', title='Sentence Number'),
        y=alt.Y(f'{base_name}_polarity', title='Polarity')
    ).properties(
        title=
            {'text':base_name.capitalize(),
            'subtitle': [
                f'Section Polarity: {polarity:.2f}',
                f'Section Subjectivity: {subjectivity:.2f}']},
        width=100,
        height=100
    )
    return chart
```

```{python}
# Intro
intro_path = 'data/intro.txt'
intro_chart = analyze_text(intro_path)

# Results
results_path = 'data/results.txt'
results_chart = analyze_text(results_path)

# Moving Forward
future_path = 'data/future.txt'
future_chart = analyze_text(future_path)

# Full text
full_path = 'data/full.txt'
full_chart = analyze_text(full_path)

# Pillar 1: Empower and Heal
p1_path = 'data/p1.txt'
p1_chart = analyze_text(p1_path)

# Pillar 2: Protect and Secure
p2_path = 'data/p2.txt'
p2_chart = analyze_text(p2_path)

# Pillar 3: Improve and Advance
p3_path = 'data/p3.txt'
p3_chart = analyze_text(p3_path)

# Pillar 4: Affect Public Policy
p4_path = 'data/p4.txt'
p4_chart = analyze_text(p4_path)

# Pillar 5: Plan and Coordinate
p5_path = 'data/p5.txt'
p5_chart = analyze_text(p5_path)

row1 = alt.hconcat(full_chart, intro_chart, future_chart)
row2 = alt.hconcat(results_chart, p1_chart, p2_chart)
row3 = alt.hconcat(p3_chart, p4_chart, p5_chart)

combined_chart = alt.vconcat(row1, row2, row3)
combined_chart.save('pictures/combined_chart.png')
```
